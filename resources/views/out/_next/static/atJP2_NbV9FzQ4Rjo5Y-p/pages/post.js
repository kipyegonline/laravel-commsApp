(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{FrwU:function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("q1tI")),o=(0,a(n("8/g6")).default)(r.default.createElement("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete");t.default=o},JbGh:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/post",function(){return n("s55V")}])},MPUk:function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("q1tI")),o=(0,a(n("8/g6")).default)(r.default.createElement("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 00-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"}),"Edit");t.default=o},OXHv:function(e,t,n){"use strict";n.d(t,"e",(function(){return r})),n.d(t,"d",(function(){return o})),n.d(t,"k",(function(){return i})),n.d(t,"j",(function(){return c})),n.d(t,"h",(function(){return s})),n.d(t,"a",(function(){return u})),n.d(t,"c",(function(){return l})),n.d(t,"g",(function(){return d})),n.d(t,"b",(function(){return f})),n.d(t,"f",(function(){return m})),n.d(t,"i",(function(){return p}));var a=n("aJdC"),r=function(e){return{type:a.a.ADD_POSTS,payload:e}},o=function(e){return{type:a.a.ADD_POST,payload:e}},i=function(e){return{type:a.a.SET_TICKS,payload:e}},c=function(e){return{type:a.a.RESOLVE_ISSUE,payload:e}},s=function(e){return{type:a.a.GET_POST,payload:e}},u=function(e){return{type:a.a.ADD_COMMENT,payload:e}},l=function(e){return{type:a.a.EDITED_COMMENT,payload:e}},d=function(e){return{type:a.a.DELETE_COMMENT,payload:e}},f=function(e){return{type:a.a.ADD_COMMENTS,payload:e}},m=function(e){return{type:a.a.ADD_RECENT_POSTS,payload:e}},p=function(e){return{type:a.a.RECENT_CLICKED,payload:e}}},Spdj:function(e,t,n){"use strict";var a=n("Ff2n"),r=n("wx14"),o=n("q1tI"),i=(n("17x9"),n("iuhU")),c=n("28cb"),s=n("EHdT"),u=n("H2TA"),l=o.forwardRef((function(e,t){var n=e.children,u=e.classes,l=e.className,d=e.component,f=void 0===d?"p":d,m=(e.disabled,e.error,e.filled,e.focused,e.margin,e.required,e.variant,Object(a.a)(e,["children","classes","className","component","disabled","error","filled","focused","margin","required","variant"])),p=Object(s.a)(),h=Object(c.a)({props:e,muiFormControl:p,states:["variant","margin","disabled","error","filled","focused","required"]});return o.createElement(f,Object(r.a)({className:Object(i.a)(u.root,("filled"===h.variant||"outlined"===h.variant)&&u.contained,l,h.disabled&&u.disabled,h.error&&u.error,h.filled&&u.filled,h.focused&&u.focused,h.required&&u.required,"dense"===h.margin&&u.marginDense),ref:t},m)," "===n?o.createElement("span",{dangerouslySetInnerHTML:{__html:"&#8203;"}}):n)}));t.a=Object(u.a)((function(e){return{root:Object(r.a)(Object(r.a)({color:e.palette.text.secondary},e.typography.caption),{},{textAlign:"left",marginTop:3,margin:0,"&$disabled":{color:e.palette.text.disabled},"&$error":{color:e.palette.error.main}}),error:{},disabled:{},marginDense:{marginTop:4},contained:{marginLeft:14,marginRight:14},focused:{},filled:{},required:{}}}),{name:"MuiFormHelperText"})(l)},aJdC:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a={ADD_POSTS:"ADD_POSTS",ADD_POST:"ADD_POST",SELECTED_USER:"SELECTED_USER",SET_TICKS:"SET_TICKS",GET_POST:"GET_POST",ADD_COMMENT:"ADD_COMMENT",DELETE_COMMENT:"DELETE_COMMENT",ADD_COMMENTS:"ADD_COMMENTS",ADD_RECENT_POSTS:"ADD_RECENT_POSTS",EDITED_COMMENT:"EDITED_COMMENT",RESOLVE_ISSUE:"RESOLVE_ISSUE",RECENT_CLICKED:"RECENT_CLICKED"}},s55V:function(e,t,n){"use strict";n.r(t);var a=n("wx14"),r=n("rePB"),o=n("ODXe"),i=n("q1tI"),c=n.n(i),s=n("nOHt"),u=n.n(s),l=n("YFqc"),d=n.n(l),f=n("vDqi"),m=n.n(f),p=n("R/WZ"),h=n("/MKj"),g=n("tRbT"),E=n("ofer"),y=n("hlFM"),b=n("iae6"),v=n("wb2y"),O=n("NrVZ"),D=n("Z3vd"),S=n("eD//"),T=n("tVbE"),_=n("IsqK"),C=n("IFCi"),j=n("SpDg"),w=n("OXHv"),N=(n("lMTm"),n("r9w1")),I=n("Spdj"),M=n("PsDL"),P=n("ADg1"),R=n("FrwU"),k=n.n(R),x=n("MPUk"),L=n.n(x),A=n("7Cbv"),q=n("EVdn"),V=n.n(q),K=c.a.createElement,F=20,U="Vince";function H(e){var t=e.comments,n=e.sendValue,a=e.post_id,r=e.handler_id,i=c.a.useState(""),s=Object(o.a)(i,2),u=s[0],l=s[1],d=Object(h.b)(),f=c.a.useRef(null),p=c.a.useRef(null),E=function(e){if(e.preventDefault(),u.trim().length>0){f.current.disabled=!0;var t={comment:u.trim(),altId:Object(A.a)(),uuid:F,post_id:a,addedon:(new Date).toLocaleTimeString(),addedIn:(new Date).toLocaleDateString(),addedUn:(new Date).toDateString(),addedEn:(new Date).toLocaleString(),addedBy:U};n(t),V.a.ajax({url:"./server/posts/posts.php?addcomment=true",data:t,type:"POST",dataType:"json"}).then((function(e){if(200!==e.status)throw new Error(e.msg);l(""),p.current.reset(),f.current.disabled=!1})).catch((function(e){f.current.disabled=!1,console.error("add err",e)})),l(""),p.current.reset()}};return K(g.a,{container:!0,spacing:2,alignItems:"flex-start",justify:"flex-start",alignContent:"flex-start"},K(g.a,{md:6,xs:12,item:!0},K("form",{onSubmit:E,onKeyPress:function(e){return"Enter"===e.key&&E(e)},ref:p},K(N.a,{label:"Write comment",variant:"outlined",multiline:!0,rows:3,cols:40,onChange:function(e){return l(e.target.value)}}),K(y.a,{className:"my-2"},K(D.a,{color:"primary",type:"submit",variant:"contained",ref:f},"Comment")))),K(g.a,{md:6,xs:12,item:!0},t.length?K(J,{comments:t.length}):null,K(z,{list:t,handler_id:r,getEdited:function(e){d(w.c(e)),V.a.ajax({type:"POST",url:"./server/posts/posts.php?editComment=true",data:e,dataType:"json"}).then((function(e){return e})).catch((function(e){return console.error(e)}))},deleteKey:function(e){confirm("Delete comment?")&&(d(w.g(e)),m.a.get("./server/posts/posts.php?deleteComment=true&id=".concat(e,"&uuid=").concat(F)))}})))}var z=function(e){var t=e.list,n=e.getEdited,a=e.deleteKey,r=c.a.useState({clicked:!1,id:void 0}),i=Object(o.a)(r,2),s=i[0],u=i[1],l=function(e){e.target&&u({clicked:!0,id:e.target.dataset.editor})};return K(y.a,null,t.map((function(e,t){return K(y.a,{key:e.altId},K("span",{style:{fontSize:16},className:"text-primary"},e.addedBy),K("p",{style:{fontSize:14,fontWeight:"normal"}},e.comment),K(I.a,null," ",e.addedEn),K(G,{id:e.altId,comment:e.comment,display:s.clicked&&s.id===e.altId,sendEdited:n,autoFocus:!0,setEditing:u}),+e.adder===F||e.uuid===F?K(c.a.Fragment,null,K(I.a,null,K(M.a,{onClick:function(){return a(e.altId)}},K(k.a,{size:"sm",color:"secondary",className:"ml-3"}))," ","|",K(M.a,{"data-editor":e.altId,onClick:l},K(L.a,{color:"primary","data-editor":e.altId})))):null,K(v.a,null))})))},J=function(e){var t=e.comments;return K(E.a,{variant:"subtitle1"},t," ",t>1?"comments":"comment")},G=function(e){var t=e.id,n=e.display,a=e.comment,r=e.sendEdited,i=e.setEditing,s=c.a.useState(a),u=Object(o.a)(s,2),l=u[0],d=u[1];c.a.useEffect((function(){d(a)}),[a]);return K(P.a,{style:{display:n?"inline":"none"}},K(N.a,{type:"text",value:l,onChange:function(e){d(e.target.value)},onKeyDown:function(e){"Enter"===e.key?l.trim().length!==a.trim().length?(r({id:t,edit:l,addedEn:(new Date).toLocaleString()}),i({clicked:!1,id:void 0}),d("")):i({clicked:!1,id:void 0}):"Escape"===e.key&&i({clicked:!1,id:void 0})}}),K(I.a,{error:!0},"press enter to comment or esc to cancel"))},B=n("L6Je"),X=c.a.createElement;function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Y=Object(p.a)({grid:{padding:"1rem",margin:".25rem",background:"#fefefe"},mainGrid:{width:"58%",background:"beige"}}),$=20,Q=(t.default=function(){var e=c.a.useState(!1),t=Object(o.a)(e,2),n=t[0],r=t[1],i=c.a.useState([]),l=Object(o.a)(i,2),d=l[0],f=l[1],p=Y(),v=Object(h.b)(),O=Object(s.useRouter)().query,D=O.issue,S=(O.title,Object(h.c)((function(e){return{post:e.posts.post,comments:e.posts.comments,issues:e.issues.deptIssues,recent:e.posts.recentPosts}}))),T=S.post,_=S.comments,C=S.issues,N=S.recent,I=function(e,t){m.a.get("./server/posts/posts.php?fetchcomments=true&uuid=".concat(e,"& postId=").concat(t)).then((function(e){if(!e.data)throw new Error("No payload attached");v(w.b(e.data))})).catch((function(e){return console.error("fetch comments:",e)}))},M=function(e){m.a.get("./server/posts/posts.php?fetchRelatedIssues=true&&uuid=".concat(e)).then((function(e){if(console.log("issues",e),e.data&&e.data.length)return e.data.map((function(e){return Z({},e,{selected:!1})}));throw new Error("No payload attached")})).then((function(e){return f(e)})).catch((function(e){return console.error("fetch issues:",e)}))},P=function(e,t,n){m.a.get("./server/posts/posts.php?fetchrecentpost=true&uuid=".concat(e,"&current=").concat(t,"&recent=").concat(n)).then((function(e){if(e.data&&e.data.length)return e.data.map((function(e){return Z({},e,{selected:!1})}));throw new Error("No payload attached")})).then((function(e){return v(w.f(e))})).catch((function(e){return console.error("fetch recent posts:",e)}))},R=function(){r(!0);var e,t,n=JSON.parse(localStorage.getItem("postAltid"));Promise.all([(e=$,t=n,void m.a.get("./server/posts/posts.php?fetchposts=true&uuid=".concat(e,"& postId=").concat(t)).then((function(e){return v(w.d(e.data))})).then((function(){return r(!1)})).catch((function(e){return console.error("fetch posts:",e)}))),I(n)]),setTimeout((function(){M($),P($,D,!0)}),2e3)};c.a.useEffect((function(){D?(v(w.h(D)),I($,D),localStorage.setItem("postAltid",JSON.stringify(D)),setTimeout((function(){M($),P($,D,!0)}),2e3)):u.a.push("/posts"),window.addEventListener("load",R)}),[]);return X(B.a,{title:T.clientName||"Post"},n?X(j.a,{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight,animation:"wave",variant:"rect"},X(b.a,{color:"primary",className:"max-auto my-auto"})):X(g.a,{container:!0,spacing:2,alignItems:"flex-start",justify:"center"},X(g.a,{item:!0,xs:!1,md:3},X(E.a,{variant:"h6"},"Recent issues"),X(te,{relatedissues:C,sendRelated:function(e){var t=d.map((function(t){return t.issue===e?Z({},t,{selected:!0}):Z({},t,{slected:!1})}));f(t),P($,e,!1)}})),X(g.a,{item:!0,className:p.mainGrid,xs:12,md:6}," ",T&&"issue"in T?X(c.a.Fragment,null,X(Q,Object(a.a)({},T,{handleResolve:function(e){m.a.get("./server/posts/posts.php?resolveissue=true&uuid=".concat($,"&issue=").concat(D,"&status=").concat(e)).then((function(t){2===e&&P($,D,!0)})).catch((function(e){return console.log(e)})),v(w.j({status:e,altId:D}))}})),X(H,{comments:_,sendValue:function(e){v(w.a(e))},post_id:T.id,handler_id:T.handler_id})):X(y.a,null,X(b.a,{color:"primary"}),X("p",null,"Reloading"))),X(g.a,{item:!0,xs:!1,md:3},X(E.a,{variant:"h6"},"Recent posts"),N.length?X(ee,{recent:N,sendRecent:function(e){v(w.i(e)),I($,e.altId)}}):X("p",null,"Loading recent posts"))))},function(e){e.issue;var t=e.clientOrg,n=e.clientPhone,a=e.clientEmail,r=e.clientName,o=e.subject,i=e.message,c=e.addedBy,s=e.handler_id,u=e.adder,l=e.status,d=e.addedon,f=e.handleResolve;return X(y.a,{className:"my-2 p-2"},X(E.a,{variant:"h6"}," ",o),X(v.a,null),X(y.a,null,X(E.a,null," ",i)),X(v.a,null),X(y.a,null,X("h6",null,"Name: ",r),X("h6",null,"Contacts: ",n,", (",a,")"),X("h6",null,"Company/location: ",t)),X(y.a,null,X("small",null," ","Added by ",X("b",null,+u===$?"You":c," ")," on ",d),X(E.a,null,"Status: ",+l)),X(y.a,null,Number(s)===$?X(O.a,{className:"my-2"},X(D.a,{variant:1===+l?"contained":"outlined",size:"small",color:"primary",className:"mr-2 my-2",onClick:function(){return f(1)}},1===+l?"In Progress":"Put in progress"),X(D.a,{variant:"contained",size:"small",color:"primary",className:"bg-success ml-1 my-2",onClick:function(){return f(2)}},2===+l?"Resolved":"Resolve")):null))}),ee=function(e){var t=e.recent,n=e.sendRecent;return X(S.a,{align:"left"},t.map((function(e){return X(T.a,{key:e.id,button:!0,divider:!0,selected:!0,className:e.selected?"bg-danger text-white":"bg-light",align:"right",onClick:function(){return n(e)}},X(_.a,{primary:e.subject,secondary:e.clientName}))})),X(T.a,null,X(d.a,{href:"/posts"},X("a",null," Back to posts"))))},te=function(e){var t=e.relatedissues,n=e.sendRelated;return X(S.a,{align:"left"},t.map((function(e,t){return X(T.a,{key:t,button:!0,divider:!0,selected:!0,className:e.selected?"bg-danger text-white":"bg-light",align:"right",onClick:function(){return n(e.issue)}},X(_.a,{primary:e.issue}),X(C.a,null,e.issuecount))})))}}},[["JbGh",0,2,7,1,3,4,5,6,9,12]]]);