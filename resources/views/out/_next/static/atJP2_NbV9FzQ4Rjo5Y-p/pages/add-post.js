(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"4VTM":function(e,t,n){"use strict";n.r(t);var a=n("KQm4"),r=n("rePB"),i=n("ODXe"),s=n("q1tI"),o=n.n(s),l=n("/MKj"),u=n("R/WZ"),c=n("EVdn"),d=n.n(c),f=n("7Cbv"),m=n("tRbT"),p=n("ADg1"),h=n("1AYd"),g=n("pdwK"),v=n("r9w1"),b=n("Spdj"),j=n("Z3vd"),O=n("30+C"),y=n("hlFM"),w=n("LYUY"),N=Object(w.a)(o.a.createElement("path",{d:"M12 7c-.55 0-1 .45-1 1v3H8c-.55 0-1 .45-1 1s.45 1 1 1h3v3c0 .55.45 1 1 1s1-.45 1-1v-3h3c.55 0 1-.45 1-1s-.45-1-1-1h-3V8c0-.55-.45-1-1-1zm0-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}),"AddCircleOutlineRounded"),C=n("L6Je"),S=n("t6oH"),E=n("5jqn"),x=n("tm1B"),D=n("lMTm"),I=n("9jvC"),P=o.a.createElement;function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var L=Object(u.a)({grid:{minWidth:300},root:{width:"90%",margin:".5rem auto",border:"1px solid red",padding:"1rem"},textarea:{width:"80",margin:"1rem auto",borderRadius:10},formControl:{width:"100%"},input:{padding:"0.15rem",width:"100%",margin:"0.25rem 0.15rem"}}),R=20;t.default=function(){var e=o.a.useState(""),t=Object(i.a)(e,2),n=t[0],r=t[1],s=o.a.useState(""),u=Object(i.a)(s,2),c=u[0],w=u[1],k=o.a.useState(""),U=Object(i.a)(k,2),A=U[0],M=U[1],V=o.a.useState(""),z=Object(i.a)(V,2),F=z[0],Y=z[1],_=o.a.useState(""),q=Object(i.a)(_,2),B=q[0],W=q[1],X=o.a.useState([]),H=Object(i.a)(X,2),J=H[0],Z=H[1],Q=o.a.useState([]),G=Object(i.a)(Q,2),$=G[0],ee=G[1],te=o.a.useState(""),ne=Object(i.a)(te,2),ae=ne[0],re=ne[1],ie=o.a.useState([]),se=Object(i.a)(ie,2),oe=se[0],le=se[1],ue=o.a.useState(""),ce=Object(i.a)(ue,2),de=ce[0],fe=ce[1],me=o.a.useState(""),pe=Object(i.a)(me,2),he=pe[0],ge=pe[1],ve=o.a.useRef(null),be=o.a.useRef(null),je=Object(l.c)((function(e){return{issues:e.issues.fetched,selectedUsers:e.users.selectedUsers,departments:e.departments.departments}})),Oe=je.issues,ye=je.selectedUsers,we=je.departments,Ne=Object(l.b)(),Ce=L(),Se=new Date;o.a.useEffect((function(){console.log("Effect, client Dept"),window.addEventListener("unload",(function(){console.log("Dom unloading")}),[oe]),window.addEventListener("load",(function(){console.log("Dom loaded")}))}),[]);var Ee=[];return P(C.a,null,P(y.a,{className:Ce.root},P("form",{className:"form",ref:ve,onSubmit:function(e){if(e.preventDefault(),n.trim().length<6)fe("Kindly add a client or company name");else if(J.length<1)fe("Kindly select the nature of issue");else if(ae.trim().length<6)fe("Kindly add the subject of the issue");else if(B.trim().length<10)fe("Kindly provide a brief description of the issue");else if(oe.length<1)fe("Please click on  the department to handle issue");else if($.length<1)fe("Please click on the officer(s) to handle issue");else if(n.trim().length>5&&J.length>0&&ae.trim().length>5&&B.trim().length>9&&oe.length>0&&$.length>0){fe(""),be.current.disabled=!0,function(e,t){e.forEach((function(e){var n=t.find((function(t){return t.userdept===e.userdept}));if(n){var r=e.id+"-"+n.id;Ee=[].concat(Object(a.a)(Ee),[K({},e,{id:r})])}}))}($,Oe);var t={clientName:n,clientPhone:c,clientEmail:A,clientOrg:F,message:B,handler:Ee.map((function(e){return e.id})).join("*"),subject:ae,clientDept:oe.join("*"),addedBy:R,status:0,altId:Object(f.a)(),addedon:(new Date).toLocaleString()};console.log("dara",Ee,t),Object(I.b)(t,"posts"),d.a.ajax({url:"./server/posts/posts.php?addposts=true",dataType:"json",cache:!1,type:"post",data:t}).then((function(e){if(console.log("res",e),200!==e.status)throw new Error(e.msg);ge(e.msg),setTimeout((function(){Ne(E.j([])),Ne(x.e([])),Ne(D.k([])),ge(),r(""),w(""),M(""),Y(""),W(""),Z([]),ee([]),re(""),le([]),Ee=[],ve.current.reset(),be.current.disabled=!1}),2e3)})).catch((function(e){be.current.disabled=!1,console.log("BBC",e,e.statusText,e.message)}))}else fe("Kindly ensure name,type of issue,subject,message,department and officer in-charge fields are not empty")}},P("h5",{className:"text-center alert alert-info p-2 my-2"},"Add new issue - ",Se.toDateString()),P(m.a,{container:!0,justify:"space-evenly",alignItems:"flex-start"},P(m.a,{item:!0,xs:!0,className:"my-3 p-2 card w-100 ".concat(Ce.grid),style:{border:"1px solid yellow"}},P("p",{className:"text-center"},"Customer details"),P(p.a,{className:Ce.formControl},P(h.a,{htmlFor:"client-name"},"Enter Name"),P(g.a,{type:"text",onChange:function(e){return r(e.target.value)},id:"client-name",variant:"outlined"})),P(p.a,{className:Ce.formControl},P(h.a,{htmlFor:"client-phone"},"Enter Phone"),P(g.a,{type:"telephone",onChange:function(e){return w(e.target.value)},id:"client-phone",variant:"outlined",className:Ce.input})),P(p.a,{className:Ce.formControl},P(h.a,{htmlFor:"client"},"Enter email"),P(g.a,{type:"email",onChange:function(e){return M(e.target.value)},id:"client-email",label:"Enter email",className:Ce.input,variant:"outlined"})),P(p.a,{className:Ce.formControl},P(h.a,{htmlFor:"client"},"Enter Organisation"),P(g.a,{type:"text",onChange:function(e){return Y(e.target.value)},id:"client-org",label:"Organisation",variant:"outlined",className:Ce.input})),Oe.length>0?P(S.d,{getIssue:function(e){if(e.length>J.length){var t=e[e.length-1],n=Oe.find((function(e){return e.id===t}));if(n)Oe.some((function(e){return e.userdept===n.userdept&&e.selected}))?alert("Cannot select 2 issues from same department, split the post into 2"):(Ne(D.e(t)),Z(e))}else J.forEach((function(t){e.indexOf(t)<0&&Ne(D.j(t.id))})),Z(e)},issue:J,issues:Oe,multiple:!0}):null,P(v.a,{label:"subject",variant:"outlined",onChange:function(e){return re(e.target.value)},fullWidth:!0,className:Ce.textarea}),P(v.a,{variant:"outlined",label:"Add Description",onChange:function(e){return W(e.target.value)},rows:3,size:"medium",focused:!0,fullWidth:!0,multiline:!0,className:Ce.textarea}),P(b.a,{error:!0},de),P(b.a,{className:"alert alert-success"},he),P(j.a,{color:"primary",size:"large",variant:"outlined",type:"submit",ref:be,startIcon:P(N,null)},"Post Issue")),P(m.a,{item:!0,xs:!0,className:Ce.grid},P(S.b,{depts:we,getDept:function(e){if(oe.includes(e.id))oe.splice(oe.indexOf(e.id),1);else{var t=e.id;le([].concat(Object(a.a)(oe),[t]))}var n=e.selected;Ne(x.c(e.id)),n?(Ne(E.i(e.id)),Ne(D.i(e.id)),ee($.filter((function(t){return t.userdept!==e.id})))):(function(e){fetch("./server/users/users.php?fetchSelectedUsers=true&id=".concat(e)).then((function(e){return e.json()})).then((function(e){if(e.length>0)return e.map((function(e){return K({},e,{selected:!1})}));throw new Error("No payload")})).then((function(e){return Ne(E.e(e))})).catch((function(e){return console.log("fetch users error",e)}))}(e.id),function(e){fetch("./server/issues/issues.php?fetchSelectedIssue=true&id=".concat(e)).then((function(e){return e.json()})).then((function(e){if(e.length>0){var t=e.map((function(e){return K({},e,{selected:!1})}));Ne(D.c(t))}throw new Error("No payload")})).catch((function(e){return console.log("fetch issue error",e)}))}(e.id))}}),P(O.a,null,P("small",null,"Selected departments"),P(T,{depts:we}))),P(m.a,{item:!0,xs:!0,className:Ce.grid},ye.length>0?P(S.c,{users:ye,getUser:function(e){if($.find((function(t){return t.id===e.id}))){var t=$.findIndex((function(t){return t.id===e.id}));$.splice(t,1),Ne(E.g(e.id))}else{$.some((function(t){return t.userdept===e.userdept}))?alert("Cannot add 2 users from the same department"):(ee([].concat(Object(a.a)($),[e])),Ne(E.g(e.id)))}}}):P("p",{className:"text-center"},"Click on department to load users"))))))};var T=function(e){return e.depts.filter((function(e){return e.selected})).map((function(e,t){return P(b.a,{key:e.id},t+1,".",e.altName)}))}},LYUY:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n("wx14"),r=n("q1tI"),i=n.n(r),s=n("HR5l");function o(e,t){var n=i.a.memo(i.a.forwardRef((function(t,n){return i.a.createElement(s.a,Object(a.a)({ref:n},t),e)})));return n.muiName=s.a.muiName,n}},t6oH:function(e,t,n){"use strict";n.d(t,"b",(function(){return j})),n.d(t,"c",(function(){return O})),n.d(t,"a",(function(){return y}));var a=n("ODXe"),r=n("q1tI"),i=n.n(r),s=n("ADg1"),o=n("1AYd"),l=n("cVXz"),u=n("jjAL"),c=n("ofer"),d=n("eD//"),f=n("tVbE"),m=n("IsqK"),p=(n("pdwK"),n("R/WZ")),h=n("l1im"),g=i.a.createElement,v=Object(p.a)({formControl:{width:"80%",margin:".5rem auto"}}),b=20;t.d=function(e){var t=e.issues,n=void 0===t?[]:t,r=e.getIssue,c=void 0===r?function(e){return e}:r,d=e.issue,f=void 0===d?"":d,m=e.multiple,p=void 0!==m&&m,h=i.a.useState(!0),b=Object(a.a)(h,2),j=b[0],O=b[1],y=v();return g(s.a,{className:y.formControl},g(o.a,{id:"issues-at-hand"},"Select Issue"),g(l.a,{labelId:"issues-at-hand",id:"issues-at-hand",value:f,variant:"filled",error:j,multiple:p,onChange:function(e){p?e.target.value.includes("")||(c(e.target.value),O(!1)):e.target.value.length>0&&(c(e.target.value),O(!1))}},g(u.a,{value:""},g("em",null,"Select Issue")),n.map((function(e){return g(u.a,{key:e.altId,value:e.id}," ",e.issue)}))))};var j=function(e){var t=e.depts,n=void 0===t?[]:t,r=e.getDept,s=void 0===r?function(e){return e}:r,o=i.a.useState(0),l=Object(a.a)(o,2),u=l[0],p=l[1],v=Math.ceil(n.length/10),b=10*u,j=10*u+10;return g(i.a.Fragment,null,g(c.a,{className:"mx-auto text-center alert alert-info my-2"},n.length," departments"),g(d.a,null,n.slice(b,j).map((function(e,t){return g(f.a,{key:e.id,dense:!0,alignItems:"center",selected:!0,className:e.selected?"bg-danger text-white":"bg-light",divider:!0,button:!0,onClick:function(){return s(e)}},g("small",{className:"mr-2"},b+t+1,". ")," ",g(m.a,{primary:e.department}))}))),n.length>10?g(h.a,{count:v,defaultValue:u+1,color:"primary",onChange:function(e,t){return p(t-1)},className:"my-2"}):null)},O=function(e){var t=e.users,n=void 0===t?[]:t,a=e.getUser,r=void 0===a?function(e){return e}:a;return g(d.a,{dense:!0},n.map((function(e,t){return g(f.a,{key:e.id,alignItems:"center",divider:!0,button:!0,onClick:function(){return r(e)},className:e.selected?"bg-info text-white":"bg-light",variant:"contained",color:"secondary"},g("small",{className:"mr-2"},t+1,". ")," ",g(m.a,{primary:e.username,secondary:e.usertitle+" - "+e.userphone}))})))};function y(e){var t=e.users,n=void 0===t?[]:t,r=e.getUser,c=void 0===r?function(e){return e}:r,d=e.user,f=void 0===d?"":d,m=e.multiple,p=void 0!==m&&m,h=i.a.useState(!0),j=Object(a.a)(h,2),O=j[0],y=j[1],w=v();return g(s.a,{className:w.formControl},g(o.a,{id:"user-at-hand"},"Select Colleauge"),g(l.a,{labelId:"user-at-hand",id:"issues-at-hand",value:f,variant:"filled",error:O,multiple:p,onChange:function(e){e.target.value.length>0&&(c(e.target.value),y(!1))}},g(u.a,{value:""},g("em",null,"Select Colleauge")),n.filter((function(e){return+e.id!==b})).map((function(e){return g(u.a,{key:e.altId,value:e.id},e.username)}))))}},v1CL:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/add-post",function(){return n("4VTM")}])}},[["v1CL",0,2,7,1,3,4,5,6,8,9]]]);